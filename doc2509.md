Com base nas fontes fornecidas e em nossa conversa, montei um fluxograma que detalha os passos da integração de dados de colaboradores do sistema LG (origem) para a plataforma Mindsight (destino), utilizando a Digibee como orquestradora do processo.

O fluxo foi desenhado para ser eficiente, focando apenas em registros que foram recentemente modificados (admitidos, alterados ou desligados), eliminando a necessidade de processar toda a base de dados a cada ciclo.

---

### **Fluxograma da Integração: Sincronização de Dados de Colaboradores (LG -> Digibee -> Mindsight)**

**Início: Gatilho Agendado na Digibee**
O processo é iniciado automaticamente por um agendamento na plataforma Digibee, conforme a frequência definida pela necessidade de negócio da Biolab.

**1. Obter Lista de Empresas**
*   **Ação (Digibee -> API LG SOAP):** Executa uma chamada ao `ServicoDeEmpresa` para consultar todas as empresas ativas na LG.
*   **Finalidade:** Obter o `CodigoDaEmpresa` de cada entidade (ex: BIOLAB SANUS FARMACEutica LTDA - Código `1`). Este código é um parâmetro obrigatório para a próxima etapa.

**2. Consultar Contratos Modificados (Loop por Empresa)**
*   **Ação (Digibee -> API LG SOAP):** Realiza um *loop*, chamando para cada empresa a capacidade `ConsultarListaDeModificados` do `ServicoDeContratoDeTrabalho`.
*   **Parâmetros da Chamada:**
    *   `CodigoDaEmpresa`: Código obtido no passo 1.
    *   `PeriodoDeBusca`: Intervalo de tempo definido para capturar apenas alterações recentes (ex: últimas 24 horas). O intervalo máximo é de 30 dias.
    *   `TiposDeOperacoes`: Filtra por Inclusão (1), Alteração (2) e Exclusão (3).
*   **Resultado:** A API da LG retorna uma lista com os identificadores (`Matricula` e `Empresa`) dos contratos que sofreram modificações.

**3. Obter Dados Detalhados dos Contratos**
*   **Ação (Digibee -> API LG SOAP):** Com a lista de contratos modificados, a Digibee chama a capacidade `ConsultarListaPorDemanda` do `ServicoDeContratoDeTrabalho`.
*   **Lógica:** A consulta é paginada, processando os dados em lotes de 50 registros para garantir a performance. Para cada página de 50 contratos, as etapas 4 e 5 são executadas.
*   **Resultado:** Retorna os dados contratuais completos, incluindo o `PessoaId`, que é a chave para a consulta de dados pessoais.

**4. Obter Dados Pessoais**
*   **Ação (Digibee -> API LG SOAP):** A Digibee extrai os 50 `PessoaId` do lote atual e chama a capacidade `ConsultarLista` do `ServicoDeColaborador`.
*   **Lógica:** Essa consulta é "intercalada" com a do passo anterior; para cada lote de 50 contratos, busca-se os 50 registros de colaboradores correspondentes.
*   **Resultado:** Retorna dados como nome completo, CPF, data de nascimento, endereço, etc..

**5. Obter Gestor Imediato**
*   **Ação (Digibee -> API LG SOAP):** Para cada contrato do lote, a Digibee chama a capacidade `ConsultarListaDeGestorImediato` do `ServicoDeContratoDeTrabalho`.
*   **Parâmetros da Chamada:** `CodigoDaEmpresa` e `Matricula` do colaborador.
*   **Resultado:** Retorna os dados de identificação do gestor direto, como matrícula, nome e CPF.

**6. Transformação dos Dados**
*   **Ação (Digibee):** A plataforma consolida as informações obtidas nos passos 3, 4 e 5. Os dados são então mapeados e transformados para o formato JSON esperado pela API da Mindsight, garantindo a conformidade e integridade da informação.

**7. Envio para a Mindsight**
*   **Ação (Digibee -> API Mindsight REST):** A Digibee envia os dados consolidados para a Mindsight, utilizando o endpoint apropriado com base no tipo de modificação identificado no Passo 2.
*   **Endpoints Utilizados:**
    *   **Admissão:** `POST /employees/create_complete/`.
    *   **Movimentação:** Endpoints de alteração como `change_area`, `change_position`, `change_manager`.
    *   **Desligamento:** `POST /employees/{id}/deactivate/`.
*   **Autenticação:** A requisição é autenticada via *token* no cabeçalho `Authorization`.

**8. Monitoramento e Governança**
*   **Ação (Digibee):** Durante todo o processo, a Digibee oferece monitoramento completo, rastreabilidade e capacidade de auditoria dos fluxos de integração.

---

Como próximo passo, poderíamos montar uma tabela de mapeamento ("DE-PARA") para um dos nove fluxos de integração planejados, como **Admissão**. Isso nos permitiria visualizar exatamente quais campos da LG serão usados para preencher os campos obrigatórios e opcionais do endpoint `create_complete` da Mindsight, o que é fundamental para a fase de construção do pipeline.
